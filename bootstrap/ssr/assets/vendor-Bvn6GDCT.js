import{createHeadManager as e,router as t,isUrlMethodPair as r,formDataToObject as a,mergeDataIntoQueryString as o,getScrollableParent as n,useInfiniteScroll as s,config as i,UseFormUtils as l,resetFormFields as u,shouldIntercept as d,shouldNavigate as c,getInitialPageFromDOM as p,setupProgress as h}from"@inertiajs/core";import{ref as v,shallowRef as f,defineComponent as g,markRaw as y,h as m,computed as b,onMounted as S,watch as F,onBeforeUnmount as P,onUnmounted as E,Fragment as C,reactive as w,createSSRApp as T}from"vue";import{escape as A,cloneDeep as $,has as k,set as O,get as N,isEqual as j}from"lodash-es";import{createValidator as x,toSimpleValidationErrors as B,resolveName as _}from"laravel-precognition";import"@inertiajs/core/server";var M={created(){if(!this.$options.remember)return;Array.isArray(this.$options.remember)&&(this.$options.remember={data:this.$options.remember}),"string"==typeof this.$options.remember&&(this.$options.remember={data:[this.$options.remember]}),"string"==typeof this.$options.remember.data&&(this.$options.remember={data:[this.$options.remember.data]});const e=this.$options.remember.key instanceof Function?this.$options.remember.key.call(this):this.$options.remember.key,r=t.restore(e),a=this.$options.remember.data.filter(e=>!(null!==this[e]&&"object"==typeof this[e]&&!1===this[e].__rememberable)),o=e=>null!==this[e]&&"object"==typeof this[e]&&"function"==typeof this[e].__remember&&"function"==typeof this[e].__restore;a.forEach(n=>{void 0!==this[n]&&void 0!==r&&void 0!==r[n]&&(o(n)?this[n].__restore(r[n]):this[n]=r[n]),this.$watch(n,()=>{t.remember(a.reduce((e,t)=>({...e,[t]:$(o(t)?this[t].__remember():this[t])}),{}),e)},{immediate:!0,deep:!0})})}};function q(...e){let{rememberKey:r,data:a,precognitionEndpoint:o}=l.parseUseFormArguments(...e);const n=r?t.restore(r):null;let s,i=$("function"==typeof a?a():a),u=null,d=e=>e,c=null,p=!1;const h=w({...n?n.data:$(i),isDirty:!1,errors:n?n.errors:{},hasErrors:!1,processing:!1,progress:null,wasSuccessful:!1,recentlySuccessful:!1,withPrecognition(...e){o=l.createWayfinderCallback(...e);const t=this;let r=!1;const a=x(e=>{const{method:t,url:r}=o(),a=$(d(this.data()));return e[t](r,a)},$(i));c=a,a.on("validatingChanged",()=>{t.validating=a.validating()}).on("validatedChanged",()=>{t.__valid=a.valid()}).on("touchedChanged",()=>{t.__touched=a.touched()}).on("errorsChanged",()=>{const e=r?a.errors():B(a.errors());this.errors={},this.setError(e),t.__valid=a.valid()});const n=(e,t)=>(t(e),e);return Object.assign(t,{__touched:[],__valid:[],validating:!1,validator:()=>a,withAllErrors:()=>n(t,()=>r=!0),valid:e=>t.__valid.includes(e),invalid:e=>e in this.errors,setValidationTimeout:e=>n(t,()=>a.setTimeout(e)),validateFiles:()=>n(t,()=>a.validateFiles()),withoutFileValidation:()=>n(t,()=>a.withoutFileValidation()),touch:(e,...r)=>(Array.isArray(e)?a.touch(e):"string"==typeof e?a.touch([e,...r]):a.touch(e),t),touched:e=>"string"==typeof e?t.__touched.includes(e):t.__touched.length>0,validate:(e,r)=>{if("object"!=typeof e||"target"in e||(r=e,e=void 0),void 0===e)a.validate(r);else{const t=_(e),o=d(this.data());a.validate(t,N(o,t),r)}return t},setErrors:e=>n(t,()=>this.setError(e)),forgetError:e=>n(t,()=>this.clearErrors(_(e)))}),t},data(){return Object.keys(i).reduce((e,t)=>O(e,t,N(this,t)),{})},transform(e){return d=e,this},defaults(e,t){if("function"==typeof a)throw new Error("You cannot call `defaults()` when using a function to define your form data.");return p=!0,void 0===e?(i=$(this.data()),this.isDirty=!1):i="string"==typeof e?O($(i),e,t):Object.assign({},$(i),e),null==c||c.defaults(i),this},reset(...e){const t=$("function"==typeof a?a():i),r=$(t);return 0===e.length?(i=r,Object.assign(this,t)):e.filter(e=>k(r,e)).forEach(e=>{O(i,e,N(r,e)),O(this,e,N(t,e))}),null==c||c.reset(...e),this},setError(e,t){const r="string"==typeof e?{[e]:t}:e;return Object.assign(this.errors,r),this.hasErrors=Object.keys(this.errors).length>0,null==c||c.setErrors(r),this},clearErrors(...e){return this.errors=Object.keys(this.errors).reduce((t,r)=>({...t,...e.length>0&&!e.includes(r)?{[r]:this.errors[r]}:{}}),{}),this.hasErrors=Object.keys(this.errors).length>0,c&&(0===e.length?c.setErrors({}):e.forEach(c.forgetError)),this},resetAndClearErrors(...e){return this.reset(...e),this.clearErrors(...e),this},submit(...e){const{method:r,url:a,options:n}=l.parseSubmitArguments(e,o);p=!1;const c={...n,onCancelToken:e=>{if(u=e,n.onCancelToken)return n.onCancelToken(e)},onBefore:e=>{if(this.wasSuccessful=!1,this.recentlySuccessful=!1,clearTimeout(s),n.onBefore)return n.onBefore(e)},onStart:e=>{if(this.processing=!0,n.onStart)return n.onStart(e)},onProgress:e=>{if(this.progress=e??null,n.onProgress)return n.onProgress(e)},onSuccess:async e=>{this.processing=!1,this.progress=null,this.clearErrors(),this.wasSuccessful=!0,this.recentlySuccessful=!0,s=setTimeout(()=>this.recentlySuccessful=!1,X.get("form.recentlySuccessfulDuration"));const t=n.onSuccess?await n.onSuccess(e):null;return p||(i=$(this.data()),this.isDirty=!1),t},onError:e=>{if(this.processing=!1,this.progress=null,this.clearErrors().setError(e),n.onError)return n.onError(e)},onCancel:()=>{if(this.processing=!1,this.progress=null,n.onCancel)return n.onCancel()},onFinish:e=>{if(this.processing=!1,this.progress=null,u=null,n.onFinish)return n.onFinish(e)}},h=d(this.data());"delete"===r?t.delete(a,{...c,data:h}):t[r](a,h,c)},get(e,t){this.submit("get",e,t)},post(e,t){this.submit("post",e,t)},put(e,t){this.submit("put",e,t)},patch(e,t){this.submit("patch",e,t)},delete(e,t){this.submit("delete",e,t)},cancel(){u&&u.cancel()},__rememberable:null===r,__remember(){return{data:this.data(),errors:this.errors}},__restore(e){Object.assign(this,e.data),this.setError(e.errors)}});return F(h,e=>{h.isDirty=!j(h.data(),i),r&&t.remember($(e.__remember()),r)},{immediate:!0,deep:!0}),o?h.withPrecognition(o):h}var D,H=v(void 0),U=v(),L=f(null),R=v(void 0),V=g({name:"Inertia",props:{initialPage:{type:Object,required:!0},initialComponent:{type:Object,required:!1},resolveComponent:{type:Function,required:!1},titleCallback:{type:Function,required:!1,default:e=>e},onHeadUpdate:{type:Function,required:!1,default:()=>()=>{}}},setup({initialPage:r,initialComponent:a,resolveComponent:o,titleCallback:n,onHeadUpdate:s}){H.value=a?y(a):void 0,U.value={...r,flash:r.flash??{}},R.value=void 0;const i="undefined"==typeof window;return D=e(i,n||(e=>e),s||(()=>{})),i||(t.init({initialPage:r,resolveComponent:o,swapComponent:async e=>{H.value=y(e.component),U.value=e.page,R.value=e.preserveState?R.value:Date.now()},onFlash:e=>{U.value={...U.value,flash:e}}}),t.on("navigate",()=>D.forceUpdate())),()=>{if(H.value){H.value.inheritAttrs=!!H.value.inheritAttrs;const e=m(H.value,{...U.value.props,key:R.value});return L.value&&(H.value.layout=L.value,L.value=null),H.value.layout?"function"==typeof H.value.layout?H.value.layout(m,e):(Array.isArray(H.value.layout)?H.value.layout:[H.value.layout]).concat(e).reverse().reduce((e,t)=>(t.inheritAttrs=!!t.inheritAttrs,m(t,{...U.value.props},()=>e))):e}}}}),I={install(e){t.form=q,Object.defineProperty(e.config.globalProperties,"$inertia",{get:()=>t}),Object.defineProperty(e.config.globalProperties,"$page",{get:()=>U.value}),Object.defineProperty(e.config.globalProperties,"$headManager",{get:()=>D}),e.mixin(M)}};function W(){return w({props:b(()=>{var e;return null==(e=U.value)?void 0:e.props}),url:b(()=>{var e;return null==(e=U.value)?void 0:e.url}),component:b(()=>{var e;return null==(e=U.value)?void 0:e.component}),version:b(()=>{var e;return null==(e=U.value)?void 0:e.version}),clearHistory:b(()=>{var e;return null==(e=U.value)?void 0:e.clearHistory}),deferredProps:b(()=>{var e;return null==(e=U.value)?void 0:e.deferredProps}),mergeProps:b(()=>{var e;return null==(e=U.value)?void 0:e.mergeProps}),prependProps:b(()=>{var e;return null==(e=U.value)?void 0:e.prependProps}),deepMergeProps:b(()=>{var e;return null==(e=U.value)?void 0:e.deepMergeProps}),matchPropsOn:b(()=>{var e;return null==(e=U.value)?void 0:e.matchPropsOn}),rememberedState:b(()=>{var e;return null==(e=U.value)?void 0:e.rememberedState}),encryptHistory:b(()=>{var e;return null==(e=U.value)?void 0:e.encryptHistory}),flash:b(()=>{var e;return null==(e=U.value)?void 0:e.flash})})}async function K({id:e="app",resolve:r,setup:a,title:o,progress:n={},page:s,render:i,defaults:l={}}){X.replace(l);const u="undefined"==typeof window,d=X.get("future.useScriptElementForInitialPage"),c=s||p(e,d),v=e=>Promise.resolve(r(e)).then(e=>e.default||e);let f=[];const g=await Promise.all([v(c.component),t.decryptHistory().catch(()=>{})]).then(([t])=>{const r={initialPage:c,initialComponent:t,resolveComponent:v,titleCallback:o};if(u){return a({el:null,App:V,props:{...r,onHeadUpdate:e=>f=e},plugin:I})}return a({el:document.getElementById(e),App:V,props:r,plugin:I})});if(!u&&n&&h(n),u&&i){const t=()=>d?[m("script",{"data-page":e,type:"application/json",innerHTML:JSON.stringify(c).replace(/\//g,"\\/")}),m("div",{id:e,innerHTML:g?i(g):""})]:m("div",{id:e,"data-page":JSON.stringify(c),innerHTML:g?i(g):""}),r=await i(T({render:()=>t()}));return{head:f,body:r}}}g({name:"Deferred",props:{data:{type:[String,Array],required:!0}},render(){var e,t;const r=Array.isArray(this.$props.data)?this.$props.data:[this.$props.data];if(!this.$slots.fallback)throw new Error("`<Deferred>` requires a `<template #fallback>` slot");return r.every(e=>void 0!==this.$page.props[e])?null==(t=(e=this.$slots).default)?void 0:t.call(e):this.$slots.fallback()}});var J=()=>{};g({name:"Form",slots:Object,props:{action:{type:[String,Object],default:""},method:{type:String,default:"get"},headers:{type:Object,default:()=>({})},queryStringArrayFormat:{type:String,default:"brackets"},errorBag:{type:[String,null],default:null},showProgress:{type:Boolean,default:!0},transform:{type:Function,default:e=>e},options:{type:Object,default:()=>({})},resetOnError:{type:[Boolean,Array],default:!1},resetOnSuccess:{type:[Boolean,Array],default:!1},setDefaultsOnSuccess:{type:Boolean,default:!1},onCancelToken:{type:Function,default:J},onBefore:{type:Function,default:J},onStart:{type:Function,default:J},onProgress:{type:Function,default:J},onFinish:{type:Function,default:J},onCancel:{type:Function,default:J},onSuccess:{type:Function,default:J},onError:{type:Function,default:J},onSubmitComplete:{type:Function,default:J},disableWhileProcessing:{type:Boolean,default:!1},invalidateCacheTags:{type:[String,Array],default:()=>[]},validateFiles:{type:Boolean,default:!1},validationTimeout:{type:Number,default:1500},withAllErrors:{type:Boolean,default:!1}},setup(e,{slots:t,attrs:n,expose:s}){const i=()=>{const[t,r]=w();return e.transform(r)},d=q({}).withPrecognition(()=>p.value,()=>w()[0]).transform(i).setValidationTimeout(e.validationTimeout);e.validateFiles&&d.validateFiles(),e.withAllErrors&&d.withAllErrors();const c=v(),p=b(()=>r(e.action)?e.action.method:e.method.toLowerCase()),h=v(!1),f=v(new FormData),g=e=>{h.value="reset"!==e.type&&!j(C(),a(f.value))},y=["input","change","reset"];S(()=>{f.value=E(),d.defaults(C()),y.forEach(e=>c.value.addEventListener(e,g))}),F(()=>e.validateFiles,e=>e?d.validateFiles():d.withoutFileValidation()),F(()=>e.validationTimeout,e=>d.setValidationTimeout(e)),P(()=>y.forEach(e=>{var t;return null==(t=c.value)?void 0:t.removeEventListener(e,g)}));const E=e=>new FormData(c.value,e),C=e=>a(E(e)),w=t=>o(p.value,r(e.action)?e.action.url:e.action,C(t),e.queryStringArrayFormat),T=t=>{const r=e=>{e&&(!0===e?A():e.length>0&&A(...e))},a={headers:e.headers,queryStringArrayFormat:e.queryStringArrayFormat,errorBag:e.errorBag,showProgress:e.showProgress,invalidateCacheTags:e.invalidateCacheTags,onCancelToken:e.onCancelToken,onBefore:e.onBefore,onStart:e.onStart,onProgress:e.onProgress,onFinish:e.onFinish,onCancel:e.onCancel,onSuccess:(...t)=>{var a,o;null==(a=e.onSuccess)||a.call(e,...t),null==(o=e.onSubmitComplete)||o.call(e,O),r(e.resetOnSuccess),!0===e.setDefaultsOnSuccess&&k()},onError:(...t)=>{var a;null==(a=e.onError)||a.call(e,...t),r(e.resetOnError)},...e.options},[o,n]=w(t);d.transform(()=>e.transform(n)).submit(p.value,o,a),d.transform(i)},A=(...e)=>{u(c.value,f.value,e),d.reset(...e)},$=(...e)=>{d.clearErrors(...e)},k=()=>{f.value=E(),h.value=!1},O={get errors(){return d.errors},get hasErrors(){return d.hasErrors},get processing(){return d.processing},get progress(){return d.progress},get wasSuccessful(){return d.wasSuccessful},get recentlySuccessful(){return d.recentlySuccessful},get validating(){return d.validating},clearErrors:$,resetAndClearErrors:(...e)=>{$(...e),A(...e)},setError:(e,t)=>d.setError("string"==typeof e?{[e]:t}:e),get isDirty(){return h.value},reset:A,submit:T,defaults:k,getData:C,getFormData:E,touch:d.touch,valid:d.valid,invalid:d.invalid,touched:d.touched,validate:(t,r)=>d.validate(...l.mergeHeadersForValidation(t,r,e.headers)),validator:()=>d.validator()};return s(O),()=>m("form",{...n,ref:c,action:r(e.action)?e.action.url:e.action,method:p.value,onSubmit:e=>{e.preventDefault(),T(e.submitter)},inert:e.disableWhileProcessing&&d.processing},t.default?t.default(O):[])}});var Y=g({props:{title:{type:String,required:!1}},data(){return{provider:this.$headManager.createProvider()}},beforeUnmount(){this.provider.disconnect()},methods:{isUnaryTag:e=>"string"==typeof e.type&&["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(e.type)>-1,renderTagStart(e){e.props=e.props||{},e.props[this.provider.preferredAttribute()]=void 0!==e.props["head-key"]?e.props["head-key"]:"";const t=Object.keys(e.props).reduce((t,r)=>{const a=String(e.props[r]);return["key","head-key"].includes(r)?t:""===a?t+` ${r}`:t+` ${r}="${A(a)}"`},"");return`<${String(e.type)}${t}>`},renderTagChildren(e){const{children:t}=e;return"string"==typeof t?t:Array.isArray(t)?t.reduce((e,t)=>e+this.renderTag(t),""):""},isFunctionNode:e=>"function"==typeof e.type,isComponentNode:e=>"object"==typeof e.type,isCommentNode:e=>/(comment|cmt)/i.test(e.type.toString()),isFragmentNode:e=>/(fragment|fgt|symbol\(\))/i.test(e.type.toString()),isTextNode:e=>/(text|txt)/i.test(e.type.toString()),renderTag(e){if(this.isTextNode(e))return String(e.children);if(this.isFragmentNode(e))return"";if(this.isCommentNode(e))return"";let t=this.renderTagStart(e);return e.children&&(t+=this.renderTagChildren(e)),this.isUnaryTag(e)||(t+=`</${String(e.type)}>`),t},addTitleElement(e){return this.title&&!e.find(e=>e.startsWith("<title"))&&e.push(`<title ${this.provider.preferredAttribute()}>${this.title}</title>`),e},renderNodes(e){const t=e.flatMap(e=>this.resolveNode(e)).map(e=>this.renderTag(e)).filter(e=>e);return this.addTitleElement(t)},resolveNode(e){return this.isFunctionNode(e)?this.resolveNode(e.type()):this.isComponentNode(e)?[]:this.isTextNode(e)&&e.children?e:this.isFragmentNode(e)&&e.children?e.children.flatMap(e=>this.resolveNode(e)):this.isCommentNode(e)?[]:e}},render(){this.provider.update(this.renderNodes(this.$slots.default?this.$slots.default():[]))}}),z=(e,t)=>e?"string"==typeof e?document.querySelector(e):"function"==typeof e?e()||null:t:t;g({name:"InfiniteScroll",slots:Object,props:{data:{type:String,required:!0},buffer:{type:Number,default:0},onlyNext:{type:Boolean,default:!1},onlyPrevious:{type:Boolean,default:!1},as:{type:String,default:"div"},manual:{type:Boolean,default:!1},manualAfter:{type:Number,default:0},preserveUrl:{type:Boolean,default:!1},reverse:{type:Boolean,default:!1},autoScroll:{type:Boolean,default:void 0},itemsElement:{type:[String,Function,Object],default:null},startElement:{type:[String,Function,Object],default:null},endElement:{type:[String,Function,Object],default:null}},inheritAttrs:!1,setup(e,{slots:t,attrs:r,expose:a}){const o=v(null),i=v(null),l=v(null),u=b(()=>z(e.itemsElement,o.value)),d=b(()=>n(u.value)),c=b(()=>z(e.startElement,i.value)),p=b(()=>z(e.endElement,l.value)),h=v(!1),f=v(!1),g=v(0),{dataManager:y,elementManager:P,flush:w}=s({getPropName:()=>e.data,inReverseMode:()=>e.reverse,shouldFetchNext:()=>!e.onlyPrevious,shouldFetchPrevious:()=>!e.onlyNext,shouldPreserveUrl:()=>e.preserveUrl,getTriggerMargin:()=>e.buffer,getStartElement:()=>c.value,getEndElement:()=>p.value,getItemsElement:()=>u.value,getScrollableParent:()=>d.value,onBeforePreviousRequest:()=>h.value=!0,onBeforeNextRequest:()=>f.value=!0,onCompletePreviousRequest:()=>{g.value=y.getRequestCount(),h.value=!1},onCompleteNextRequest:()=>{g.value=y.getRequestCount(),f.value=!1}});g.value=y.getRequestCount();const T=b(()=>!A.value),A=b(()=>e.manual||e.manualAfter>0&&g.value>=e.manualAfter);return S(()=>{P.setupObservers(),P.processServerLoadedElements(y.getLastLoadedPage());(void 0!==e.autoScroll?e.autoScroll:e.reverse)&&(d.value?d.value.scrollTo({top:d.value.scrollHeight,behavior:"instant"}):window.scrollTo({top:document.body.scrollHeight,behavior:"instant"})),T.value&&P.enableTriggers()}),E(w),F(()=>[T.value,e.onlyNext,e.onlyPrevious],([e])=>{e?P.enableTriggers():P.disableTriggers()}),a({fetchNext:y.fetchNext,fetchPrevious:y.fetchPrevious,hasPrevious:y.hasPrevious,hasNext:y.hasNext}),()=>{var a,n,s;const u=[],d={loadingPrevious:h.value,loadingNext:f.value,hasPrevious:y.hasPrevious(),hasNext:y.hasNext()};if(!e.startElement){const r=T.value&&!e.onlyNext,o={loading:h.value,fetch:y.fetchPrevious,autoMode:r,manualMode:!r,hasMore:y.hasPrevious(),...d};u.push(m("div",{ref:i},t.previous?t.previous(o):h.value?null==(a=t.loading)?void 0:a.call(t,o):void 0))}if(u.push(m(e.as,{...r,ref:o},null==(n=t.default)?void 0:n.call(t,{loading:h.value||f.value,loadingPrevious:h.value,loadingNext:f.value}))),!e.endElement){const r=T.value&&!e.onlyPrevious,a={loading:f.value,fetch:y.fetchNext,autoMode:r,manualMode:!r,hasMore:y.hasNext(),...d};u.push(m("div",{ref:l},t.next?t.next(a):f.value?null==(s=t.loading)?void 0:s.call(t,a):void 0))}return m(C,{},e.reverse?[...u].reverse():u)}}});var G=()=>{},Q=g({name:"Link",props:{as:{type:[String,Object],default:"a"},data:{type:Object,default:()=>({})},href:{type:[String,Object],default:""},method:{type:String,default:"get"},replace:{type:Boolean,default:!1},preserveScroll:{type:[Boolean,String,Function],default:!1},preserveState:{type:[Boolean,String,Function],default:null},preserveUrl:{type:Boolean,default:!1},only:{type:Array,default:()=>[]},except:{type:Array,default:()=>[]},headers:{type:Object,default:()=>({})},queryStringArrayFormat:{type:String,default:"brackets"},async:{type:Boolean,default:!1},prefetch:{type:[Boolean,String,Array],default:!1},cacheFor:{type:[Number,String,Array],default:0},onStart:{type:Function,default:G},onProgress:{type:Function,default:G},onFinish:{type:Function,default:G},onBefore:{type:Function,default:G},onCancel:{type:Function,default:G},onSuccess:{type:Function,default:G},onError:{type:Function,default:G},onCancelToken:{type:Function,default:G},onPrefetching:{type:Function,default:G},onPrefetched:{type:Function,default:G},cacheTags:{type:[String,Array],default:()=>[]},viewTransition:{type:[Boolean,Object],default:!1}},setup(e,{slots:a,attrs:n}){const s=v(0),i=v(),l=b(()=>!0===e.prefetch?["hover"]:!1===e.prefetch?[]:Array.isArray(e.prefetch)?e.prefetch:[e.prefetch]),u=b(()=>0!==e.cacheFor?e.cacheFor:1===l.value.length&&"click"===l.value[0]?0:X.get("prefetch.cacheFor"));S(()=>{l.value.includes("mount")&&w()}),E(()=>{clearTimeout(i.value)});const p=b(()=>r(e.href)?e.href.method:(e.method??"get").toLowerCase()),h=b(()=>"string"!=typeof e.as||"a"!==e.as.toLowerCase()?e.as:"get"!==p.value?"button":e.as.toLowerCase()),f=b(()=>o(p.value,r(e.href)?e.href.url:e.href,e.data||{},e.queryStringArrayFormat)),g=b(()=>f.value[0]),y=b(()=>f.value[1]),F=b(()=>"button"===h.value?{type:"button"}:"a"===h.value||"string"!=typeof h.value?{href:g.value}:{}),P=b(()=>({data:y.value,method:p.value,replace:e.replace,preserveScroll:e.preserveScroll,preserveState:e.preserveState??"get"!==p.value,preserveUrl:e.preserveUrl,only:e.only,except:e.except,headers:e.headers,async:e.async})),C=b(()=>({...P.value,viewTransition:e.viewTransition,onCancelToken:e.onCancelToken,onBefore:e.onBefore,onStart:t=>{var r;s.value++,null==(r=e.onStart)||r.call(e,t)},onProgress:e.onProgress,onFinish:t=>{var r;s.value--,null==(r=e.onFinish)||r.call(e,t)},onCancel:e.onCancel,onSuccess:e.onSuccess,onError:e.onError})),w=()=>{t.prefetch(g.value,{...P.value,onPrefetching:e.onPrefetching,onPrefetched:e.onPrefetched},{cacheFor:u.value,cacheTags:e.cacheTags})},T={onClick:e=>{d(e)&&(e.preventDefault(),t.visit(g.value,C.value))}},A={onMouseenter:()=>{i.value=setTimeout(()=>{w()},X.get("prefetch.hoverDelay"))},onMouseleave:()=>{clearTimeout(i.value)},onClick:T.onClick},$={onMousedown:e=>{d(e)&&(e.preventDefault(),w())},onKeydown:e=>{c(e)&&(e.preventDefault(),w())},onMouseup:e=>{d(e)&&(e.preventDefault(),t.visit(g.value,C.value))},onKeyup:e=>{c(e)&&(e.preventDefault(),t.visit(g.value,C.value))},onClick:e=>{d(e)&&e.preventDefault()}};return()=>m(h.value,{...n,...F.value,"data-loading":s.value>0?"":void 0,...l.value.includes("hover")?A:l.value.includes("click")?$:T},a)}});g({name:"WhenVisible",slots:Object,props:{data:{type:[String,Array]},params:{type:Object},buffer:{type:Number,default:0},as:{type:String,default:"div"},always:{type:Boolean,default:!1}},data:()=>({loaded:!1,fetching:!1,observer:null}),unmounted(){var e;null==(e=this.observer)||e.disconnect()},computed:{keys(){return this.data?Array.isArray(this.data)?this.data:[this.data]:[]}},created(){const e=W();this.$watch(()=>this.keys.map(t=>e.props[t]),()=>{const t=this.keys.length>0&&this.keys.every(t=>void 0!==e.props[t]);this.loaded=t,t&&!this.always||this.$nextTick(this.registerObserver)},{immediate:!0})},methods:{registerObserver(){var e;null==(e=this.observer)||e.disconnect(),this.observer=new IntersectionObserver(e=>{if(!e[0].isIntersecting)return;if(this.fetching)return;if(!this.always&&this.loaded)return;this.fetching=!0;const r=this.getReloadParams();t.reload({...r,onStart:e=>{var t;this.fetching=!0,null==(t=r.onStart)||t.call(r,e)},onFinish:e=>{var t,a;this.loaded=!0,this.fetching=!1,null==(t=r.onFinish)||t.call(r,e),this.always||null==(a=this.observer)||a.disconnect()}})},{rootMargin:`${this.$props.buffer}px`}),this.observer.observe(this.$el.nextSibling)},getReloadParams(){const e={...this.$props.params};return this.$props.data&&(e.only=Array.isArray(this.$props.data)?this.$props.data:[this.$props.data]),e}},render(){const e=[];return!this.$props.always&&this.loaded||e.push(m(this.$props.as)),this.loaded?this.$slots.default&&e.push(this.$slots.default({fetching:this.fetching})):e.push(this.$slots.fallback?this.$slots.fallback({}):null),e}});var X=i.extend({});export{W as a,K as c,Y as h,Q as l,q as u};
